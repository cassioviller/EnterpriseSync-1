{% extends "base_completo.html" %}

{% block title %}Logs de Produção - SIGE{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-danger text-white">
                    <h4><i class="fas fa-bug"></i> Logs de Produção - Sistema de Debugging</h4>
                    <small>Visualização de erros e debug para ambiente de produção</small>
                </div>
                <div class="card-body">
                    <!-- Status do Sistema -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="alert alert-info">
                                <h6><i class="fas fa-info-circle"></i> Status do Sistema</h6>
                                <p class="mb-0">
                                    <strong>Environment:</strong> {{ request.environ.get('FLASK_ENV', 'unknown') }}<br>
                                    <strong>Timestamp:</strong> {{ moment().format('YYYY-MM-DD HH:mm:ss') }}
                                </p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-warning">
                                <h6><i class="fas fa-exclamation-triangle"></i> Atenção</h6>
                                <p class="mb-0">
                                    Este endpoint é apenas para debugging de produção.<br>
                                    <strong>Não expor em produção final!</strong>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Logs de Erro -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card border-danger">
                                <div class="card-header bg-danger text-white">
                                    <h5><i class="fas fa-exclamation-circle"></i> Logs de Erro (Últimas 50 linhas)</h5>
                                </div>
                                <div class="card-body">
                                    {% if logs.error_logs %}
                                        <pre class="bg-dark text-light p-3" style="max-height: 400px; overflow-y: auto;">
{% for line in logs.error_logs %}{{ line }}{% endfor %}
                                        </pre>
                                    {% else %}
                                        <div class="alert alert-success">
                                            <i class="fas fa-check-circle"></i> Nenhum erro encontrado nos logs!
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Logs de Debug -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <h5><i class="fas fa-code"></i> Logs de Debug (Últimas 100 linhas)</h5>
                                </div>
                                <div class="card-body">
                                    {% if logs.debug_logs %}
                                        <pre class="bg-light text-dark p-3" style="max-height: 600px; overflow-y: auto;">
{% for line in logs.debug_logs %}{{ line }}{% endfor %}
                                        </pre>
                                    {% else %}
                                        <div class="alert alert-info">
                                            <i class="fas fa-info-circle"></i> Nenhum log de debug disponível.
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botões de Ação -->
                    <div class="row mt-4">
                        <div class="col-12 text-center">
                            <button class="btn btn-primary" onclick="location.reload()">
                                <i class="fas fa-sync"></i> Atualizar Logs
                            </button>
                            <a href="/debug/system-status" class="btn btn-info">
                                <i class="fas fa-heartbeat"></i> Status do Sistema
                            </a>
                            <a href="/dashboard" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
pre {
    font-family: 'Courier New', monospace;
    font-size: 12px;
    line-height: 1.4;
    white-space: pre-wrap;
    word-wrap: break-word;
}

.card-header {
    position: sticky;
    top: 0;
    z-index: 10;
}
</style>
{% endblock %}