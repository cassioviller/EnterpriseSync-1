{% extends "base_completo.html" %}

{% block title %}Configurações de Obras - Ponto{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <a href="{{ url_for('ponto.index') }}" class="btn btn-outline-secondary mb-3">
                <i class="fas fa-arrow-left me-2"></i>
                Voltar
            </a>
            
            <h2>
                <i class="fas fa-cog me-2"></i>
                Configurações de Obras para Ponto
            </h2>
            <p class="text-muted">Gerencie quais obras cada funcionário pode selecionar ao bater ponto</p>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            {% if funcionarios_configs %}
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Funcionário</th>
                                        <th>Código</th>
                                        <th>Obras Configuradas</th>
                                        <th class="text-center">Total</th>
                                        <th class="text-end">Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in funcionarios_configs %}
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                {% if item.funcionario.foto_base64 %}
                                                <img src="{{ item.funcionario.foto_base64 }}" 
                                                     alt="{{ item.funcionario.nome }}" 
                                                     class="rounded-circle me-2"
                                                     style="width: 40px; height: 40px; object-fit: cover;">
                                                {% else %}
                                                <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-2"
                                                     style="width: 40px; height: 40px; font-size: 16px;">
                                                    {{ item.funcionario.nome[0].upper() }}
                                                </div>
                                                {% endif %}
                                                <strong>{{ item.funcionario.nome }}</strong>
                                            </div>
                                        </td>
                                        <td>{{ item.funcionario.codigo }}</td>
                                        <td>
                                            {% if item.obras_configuradas %}
                                                {% for obra in item.obras_configuradas[:3] %}
                                                <span class="badge bg-primary me-1">{{ obra.nome }}</span>
                                                {% endfor %}
                                                {% if item.obras_configuradas|length > 3 %}
                                                <span class="badge bg-secondary">+{{ item.obras_configuradas|length - 3 }}</span>
                                                {% endif %}
                                            {% else %}
                                            <span class="text-muted">
                                                <i class="fas fa-globe me-1"></i>
                                                Todas as obras
                                            </span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            {% if item.total_obras > 0 %}
                                            <span class="badge bg-success">{{ item.total_obras }}</span>
                                            {% else %}
                                            <span class="badge bg-secondary">Todas</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-end">
                                            <a href="{{ url_for('ponto.configurar_obras_funcionario', funcionario_id=item.funcionario.id) }}" 
                                               class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-edit me-1"></i>
                                                Configurar
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Nenhum funcionário ativo cadastrado.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
