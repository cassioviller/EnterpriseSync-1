<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progresso - {{ obra.nome }} | SIGE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .main-container { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 20px; margin: 20px; min-height: calc(100vh - 40px); }
        .progress-card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); }
        .rdo-progress { border-left: 4px solid #3498db; padding-left: 15px; }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1><i class="fas fa-chart-line me-3"></i>Progresso Detalhado</h1>
                <a href="{{ url_for('main.cliente_obra_dashboard', token=obra.token_cliente) }}" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i>Voltar
                </a>
            </div>
            
            <!-- Resumo Geral -->
            <div class="progress-card">
                <h3 class="mb-3">Resumo Geral da Obra</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="progress mb-3" style="height: 30px;">
                            <div class="progress-bar bg-success" style="width: {{ progresso_geral.percentual_geral }}%">
                                {{ progresso_geral.percentual_geral }}%
                            </div>
                        </div>
                        <p class="mb-2"><strong>Progresso Geral:</strong> {{ progresso_geral.percentual_geral }}%</p>
                        <p class="mb-2"><strong>Atividades Concluídas:</strong> {{ progresso_geral.atividades_concluidas }}</p>
                        <p class="mb-0"><strong>Velocidade Média:</strong> {{ progresso_geral.velocidade_media }}% por dia</p>
                    </div>
                    {% if previsao and previsao.data_previsao %}
                    <div class="col-md-6">
                        <div class="text-center">
                            <h4 class="text-primary">{{ previsao.data_previsao.strftime('%d/%m/%Y') }}</h4>
                            <p class="text-muted">Previsão de Conclusão</p>
                            <span class="badge bg-{{ 'success' if previsao.confianca == 'alta' else 'warning' if previsao.confianca == 'media' else 'danger' }}">
                                {{ previsao.confianca|title }} Confiança
                            </span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Progresso por RDO -->
            <div class="progress-card">
                <h3 class="mb-3">Progresso por Relatório</h3>
                {% for item in rdos_progresso %}
                <div class="rdo-progress mb-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h5 class="mb-1">{{ item.rdo.numero_rdo }}</h5>
                            <p class="text-muted mb-2">{{ item.rdo.data_relatorio.strftime('%d/%m/%Y') }}</p>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar" style="width: {{ item.eficiencia }}%">
                                    {{ item.eficiencia }}%
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="text-primary h4 mb-0">{{ item.atividades_concluidas }}/{{ item.atividades_total }}</div>
                            <small class="text-muted">Atividades Concluídas</small>
                        </div>
                    </div>
                    
                    <!-- Detalhes das Atividades -->
                    <div class="mt-3">
                        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#atividades{{ loop.index }}">
                            <i class="fas fa-chevron-down me-1"></i>Ver Atividades ({{ item.atividades_total }})
                        </button>
                        <div class="collapse" id="atividades{{ loop.index }}">
                            <div class="mt-3">
                                {% for atividade in item.atividades %}
                                <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                    <div>
                                        <span class="me-2">{{ atividade.descricao_atividade }}</span>
                                        {% if (atividade.percentual_conclusao or 0) >= 100 %}
                                        <i class="fas fa-check-circle text-success"></i>
                                        {% else %}
                                        <i class="fas fa-clock text-warning"></i>
                                        {% endif %}
                                    </div>
                                    <span class="badge bg-{% if (atividade.percentual_conclusao or 0) >= 100 %}success{% elif (atividade.percentual_conclusao or 0) >= 50 %}warning{% else %}secondary{% endif %}">
                                        {{ atividade.percentual_conclusao or 0 }}%
                                    </span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                
                {% if not rdos_progresso %}
                <p class="text-muted text-center">Nenhum relatório finalizado ainda.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>