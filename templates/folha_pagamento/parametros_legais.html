{% extends "base_completo.html" %}

{% block title %}Parâmetros Legais - Folha de Pagamento{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-0">
                        <i class="fas fa-balance-scale text-primary me-2"></i>
                        Parâmetros Legais
                    </h1>
                    <p class="text-muted small mb-0">Configure INSS, IRRF, FGTS e demais parâmetros legais da folha de pagamento</p>
                </div>
                <div>
                    <a href="{{ url_for('folha.dashboard') }}" class="btn btn-outline-secondary me-2">
                        <i class="fas fa-arrow-left me-1"></i>
                        Voltar ao Dashboard
                    </a>
                    <a href="{{ url_for('folha.criar_parametros') }}" class="btn btn-primary">
                        <i class="fas fa-plus me-1"></i>
                        Novo Ano
                    </a>
                </div>
            </div>
        </div>
    </div>

    {% if parametros %}
    <!-- Lista de Parâmetros -->
    <div class="row g-3">
        {% for parametro in parametros %}
        <div class="col-md-6 col-xl-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-{{ 'success' if parametro.ativo else 'secondary' }} text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-alt me-2"></i>
                        Ano {{ parametro.ano_vigencia }}
                    </h5>
                    <span class="badge bg-{{ 'light text-success' if parametro.ativo else 'dark' }}">
                        {{ 'Ativo' if parametro.ativo else 'Inativo' }}
                    </span>
                </div>
                <div class="card-body">
                    <!-- INSS -->
                    <h6 class="text-primary mb-2">
                        <i class="fas fa-university me-1"></i>
                        INSS
                    </h6>
                    <div class="small mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Faixa 1 (até R$ {{ "{:,.2f}".format(parametro.inss_faixa1_limite) }})</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.inss_faixa1_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Faixa 2 (até R$ {{ "{:,.2f}".format(parametro.inss_faixa2_limite) }})</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.inss_faixa2_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Faixa 3 (até R$ {{ "{:,.2f}".format(parametro.inss_faixa3_limite) }})</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.inss_faixa3_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Faixa 4 (até R$ {{ "{:,.2f}".format(parametro.inss_faixa4_limite) }})</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.inss_faixa4_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between border-top pt-1">
                            <span class="text-muted">Teto INSS</span>
                            <span class="fw-bold text-success">R$ {{ "{:,.2f}".format(parametro.inss_teto) }}</span>
                        </div>
                    </div>

                    <!-- IRRF -->
                    <h6 class="text-warning mb-2">
                        <i class="fas fa-receipt me-1"></i>
                        IRRF
                    </h6>
                    <div class="small mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Isenção</span>
                            <span class="fw-bold">R$ {{ "{:,.2f}".format(parametro.irrf_isencao) }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Faixa 1</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.irrf_faixa1_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Faixa 2</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.irrf_faixa2_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Faixa 3</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.irrf_faixa3_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Faixa 4</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.irrf_faixa4_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between border-top pt-1">
                            <span class="text-muted">Dependente</span>
                            <span class="fw-bold text-warning">R$ {{ "{:,.2f}".format(parametro.irrf_dependente_valor) }}</span>
                        </div>
                    </div>

                    <!-- Outros -->
                    <h6 class="text-info mb-2">
                        <i class="fas fa-cog me-1"></i>
                        Outros Parâmetros
                    </h6>
                    <div class="small mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">FGTS</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.fgts_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Salário Mínimo</span>
                            <span class="fw-bold">R$ {{ "{:,.2f}".format(parametro.salario_minimo) }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Vale Transporte</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.vale_transporte_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Adicional Noturno</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.adicional_noturno_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Hora Extra 50%</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.hora_extra_50_percentual) }}%</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">Hora Extra 100%</span>
                            <span class="fw-bold">{{ "{:.1f}".format(parametro.hora_extra_100_percentual) }}%</span>
                        </div>
                    </div>

                    <div class="small text-muted border-top pt-2">
                        <i class="fas fa-clock me-1"></i>
                        Atualizado em {{ parametro.updated_at.strftime('%d/%m/%Y %H:%M') if parametro.updated_at else parametro.created_at.strftime('%d/%m/%Y %H:%M') }}
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <div class="d-flex gap-2">
                        <a href="{{ url_for('folha.editar_parametros', id=parametro.id) }}" class="btn btn-sm btn-outline-primary flex-grow-1">
                            <i class="fas fa-edit me-1"></i>
                            Editar
                        </a>
                        <form method="POST" action="{{ url_for('folha.toggle_parametros', id=parametro.id) }}" class="flex-grow-1">
                            <button type="submit" class="btn btn-sm btn-outline-{{ 'secondary' if parametro.ativo else 'success' }} w-100">
                                <i class="fas fa-{{ 'toggle-off' if parametro.ativo else 'toggle-on' }} me-1"></i>
                                {{ 'Desativar' if parametro.ativo else 'Ativar' }}
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- Estado vazio -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center py-5">
                    <i class="fas fa-balance-scale fa-4x text-muted mb-3"></i>
                    <h4 class="text-muted">Nenhum parâmetro legal cadastrado</h4>
                    <p class="text-muted mb-4">Configure os parâmetros legais para começar a processar a folha de pagamento.</p>
                    <a href="{{ url_for('folha.criar_parametros') }}" class="btn btn-primary btn-lg">
                        <i class="fas fa-plus me-2"></i>
                        Cadastrar Primeiro Parâmetro
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
