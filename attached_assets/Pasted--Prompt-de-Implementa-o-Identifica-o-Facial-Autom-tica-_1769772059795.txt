# Prompt de Implementa칞칚o: Identifica칞칚o Facial Autom치tica

## 游꿢 Objetivo

Criar uma nova tela de "Ponto por Reconhecimento Facial" onde o sistema identifica automaticamente o funcion치rio e registra o ponto, sem necessidade de sele칞칚o manual.

## 游늶 Instru칞칫es para o Replit Agent

### Fase 1: Backend - API de Identifica칞칚o

1.  **Crie uma nova rota:** `/ponto/api/identificar-e-registrar` (POST)
2.  **L칩gica da API:**
    -   Recebe a foto capturada em base64.
    -   Busca **todos** os funcion치rios ativos que possuem foto cadastrada.
    -   Usa a fun칞칚o `DeepFace.find()` para encontrar o funcion치rio mais parecido.
    -   Se a dist칙ncia for menor que o threshold (ex: 0.4), registra o ponto para o funcion치rio encontrado.
    -   Se n칚o encontrar ningu칠m, retorna erro "Funcion치rio n칚o identificado".

**Exemplo de C칩digo:**
```python
from deepface import DeepFace

@ponto_bp.route('/api/identificar-e-registrar', methods=['POST'])
def identificar_e_registrar():
    data = request.get_json()
    foto_capturada = data['foto_base64']

    # Diret칩rio com as fotos dos funcion치rios
    db_path = "/app/static/fotos_funcionarios/"

    try:
        # Encontra o funcion치rio mais parecido
        dfs = DeepFace.find(img_path=foto_capturada, db_path=db_path, model_name='VGG-Face', distance_metric='cosine')

        if not dfs or dfs[0].empty:
            return jsonify({'success': False, 'message': 'Funcion치rio n칚o identificado'}), 404

        # Pega o resultado mais prov치vel
        best_match = dfs[0].iloc[0]
        distancia = best_match['VGG-Face_cosine']

        if distancia > 0.4: # Threshold
            return jsonify({'success': False, 'message': 'Funcion치rio n칚o identificado'}), 404

        # Extrai o ID do funcion치rio do nome do arquivo
        # Ex: /app/static/fotos_funcionarios/funcionario_123.jpg -> 123
        caminho_foto = best_match['identity']
        funcionario_id = int(caminho_foto.split('_')[-1].split('.')[0])

        # L칩gica para registrar o ponto (reaproveitar do outro endpoint)
        # ...

        return jsonify({'success': True, 'message': 'Ponto registrado com sucesso!'})

    except Exception as e:
        return jsonify({'success': False, 'message': str(e)}), 500
```

### Fase 2: Frontend - Nova Tela de Ponto

1.  **Crie um novo template:** `ponto_facial_automatico.html`
2.  **Interface:**
    -   Preview da c칙mera em tela cheia.
    -   Bot칚o "Registrar Ponto".
    -   츼rea para exibir o resultado (sucesso/erro).
3.  **JavaScript:**
    -   Ao clicar no bot칚o, captura a foto.
    -   Envia para a nova API `/ponto/api/identificar-e-registrar`.
    -   Exibe o resultado na tela.

### Fase 3: Rota e Menu

1.  **Crie uma nova rota:** `/ponto/facial` que renderiza o template `ponto_facial_automatico.html`.
2.  **Adicione um link no menu:** "Ponto por Reconhecimento Facial".

## 游 Pr칩ximos Passos para o Usu치rio

1.  **Teste** a nova tela com diferentes funcion치rios.
2.  **Ajuste** o threshold de dist칙ncia se necess치rio.
3.  **Verifique** a performance com todos os funcion치rios cadastrados.

O sistema estar치 pronto para identifica칞칚o facial autom치tica! 游꿢
