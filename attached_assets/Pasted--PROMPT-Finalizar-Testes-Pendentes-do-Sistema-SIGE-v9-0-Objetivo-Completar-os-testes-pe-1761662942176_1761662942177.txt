# üöÄ PROMPT: Finalizar Testes Pendentes do Sistema SIGE v9.0

**Objetivo:** Completar os testes pendentes identificados no relat√≥rio de testes, corrigir bugs encontrados e validar todas as integra√ß√µes do sistema SIGE.

---

## üìä AN√ÅLISE DO RELAT√ìRIO ATUAL

Baseado no **RELATORIO_TESTES_SIGE_v9.0.md**, o sistema est√° com:

- ‚úÖ **Taxa de sucesso:** 89,4% (42/47 cen√°rios)
- ‚úÖ **M√≥dulos 100% funcionais:** 7/15 (46,7%)
- ‚ö†Ô∏è **M√≥dulos com gaps:** 5/15 (33,3%)
- ‚ùå **M√≥dulos n√£o testados:** 3/15 (20%)

---

## üéØ TAREFAS PRIORIT√ÅRIAS

### **PRIORIDADE 1: CORRE√á√ïES CR√çTICAS** üî¥

#### **1.1 - Validar e Corrigir Descontos de Falta/Atraso**

**Problema Identificado:**
- Diverg√™ncia de R$ 174,17 no sal√°rio l√≠quido de Setembro
- Descontos de falta e atraso podem n√£o estar sendo aplicados

**A√ß√£o:**
1. Verificar o c√≥digo de `calcular_salario_bruto()` em `folha_service.py`
2. Confirmar se descontos de falta est√£o sendo aplicados:
   ```python
   if horas_info['faltas'] > 0:
       valor_dia = salario_base / Decimal('30')
       desconto_faltas = valor_dia * Decimal(str(horas_info['faltas']))
   ```
3. Confirmar se descontos de atraso est√£o sendo aplicados
4. Reprocessar folha de Setembro/2025 do funcion√°rio "Jo√£o da Silva"
5. Validar que o sal√°rio l√≠quido est√° correto

**Valores Esperados (Setembro/2025):**
- Sal√°rio bruto: R$ 2.599,01
- INSS: R$ 227,92
- IRRF: R$ 0,00
- **Sal√°rio l√≠quido: R$ 2.371,09**

**Crit√©rio de Sucesso:**
- [ ] Desconto de falta (R$ 83,33) aplicado
- [ ] Desconto de DSR por falta (R$ 83,33) aplicado
- [ ] Desconto de atraso (R$ 2,84) aplicado
- [ ] Sal√°rio l√≠quido = R$ 2.371,09

---

#### **1.2 - Inicializar Plano de Contas**

**Problema Identificado:**
- Contabilidade autom√°tica bloqueada
- Lan√ßamentos cont√°beis n√£o est√£o sendo criados

**A√ß√£o:**
1. Acessar `/contabilidade/plano-contas`
2. Criar as contas padr√£o necess√°rias:

**Contas a Criar:**

| C√≥digo | Nome | Tipo | Natureza |
|---|---|---|---|
| 1.1.1 | Caixa | Ativo | Devedora |
| 1.1.2 | Bancos | Ativo | Devedora |
| 1.2.1 | Contas a Receber | Ativo | Devedora |
| 2.1.1 | Fornecedores | Passivo | Credora |
| 2.1.2 | Sal√°rios a Pagar | Passivo | Credora |
| 2.1.3 | INSS a Recolher | Passivo | Credora |
| 2.1.4 | IRRF a Recolher | Passivo | Credora |
| 2.1.5 | FGTS a Recolher | Passivo | Credora |
| 3.1.1 | Despesas com Pessoal | Despesa | Devedora |
| 3.1.2 | Despesas com Materiais | Despesa | Devedora |
| 3.1.3 | Despesas com Servi√ßos | Despesa | Devedora |
| 4.1.1 | Receitas de Servi√ßos | Receita | Credora |

3. Ap√≥s criar, reprocessar folha de Outubro/2025
4. Verificar se lan√ßamento cont√°bil foi criado automaticamente
5. Validar partidas dobradas (d√©bito = cr√©dito)

**Crit√©rio de Sucesso:**
- [ ] 12 contas criadas no Plano de Contas
- [ ] Lan√ßamento cont√°bil criado ao processar folha
- [ ] Partidas dobradas corretas
- [ ] Evento `folha_processada` dispara handler

---

### **PRIORIDADE 2: CRIAR DADOS DE TESTE COMPLETOS** üü°

#### **2.1 - Almoxarifado**

**Status Atual:** 0 movimentos

**A√ß√£o:**
1. Criar **5 categorias** de materiais:
   - Materiais de Constru√ß√£o
   - Ferramentas
   - EPIs
   - El√©trica
   - Hidr√°ulica

2. Criar **10 itens** de estoque:
   - Cimento (50 sacos)
   - Areia (10 m¬≥)
   - Brita (5 m¬≥)
   - Tijolo (1000 unidades)
   - Martelo (5 unidades)
   - Capacete (20 unidades)
   - Luva (50 pares)
   - Fio el√©trico (100 metros)
   - Cano PVC (50 metros)
   - Joelho PVC (30 unidades)

3. Criar **5 entradas** de materiais:
   - Fornecedor: "Construmax Ltda"
   - Nota fiscal: NF-001 a NF-005
   - Valores variados (R$ 500 a R$ 5.000)

4. Criar **5 sa√≠das** de materiais para obras:
   - Obra: "Residencial Jardim das Flores"
   - Requisitante: Funcion√°rios cadastrados
   - Materiais variados

**Crit√©rio de Sucesso:**
- [ ] 5 categorias criadas
- [ ] 10 itens criados
- [ ] 5 entradas registradas
- [ ] 5 sa√≠das registradas
- [ ] Estoque atualizado corretamente

---

#### **2.2 - Financeiro**

**Status Atual:** 0 contas a pagar, 0 contas a receber

**A√ß√£o:**
1. Criar **5 fornecedores**:
   - Construmax Ltda (CNPJ: 12.345.678/0001-90)
   - Materiais S√£o Jos√© (CNPJ: 98.765.432/0001-10)
   - Ferragens Central (CNPJ: 11.222.333/0001-44)
   - El√©trica Silva (CNPJ: 55.666.777/0001-88)
   - Hidr√°ulica Santos (CNPJ: 99.888.777/0001-66)

2. Criar **10 contas a pagar**:
   - Fornecedores variados
   - Valores: R$ 500 a R$ 10.000
   - Vencimentos: Setembro e Outubro 2025
   - Status: 5 pendentes, 3 pagas, 2 vencidas

3. Criar **5 clientes**:
   - Jo√£o Carlos Silva (CPF: 123.456.789-00)
   - Maria Oliveira Santos (CPF: 987.654.321-00)
   - Empresa ABC Ltda (CNPJ: 22.333.444/0001-55)
   - Construtora XYZ (CNPJ: 66.777.888/0001-99)
   - Imobili√°ria Boa Vista (CNPJ: 44.555.666/0001-77)

4. Criar **10 contas a receber**:
   - Clientes variados
   - Valores: R$ 1.000 a R$ 50.000
   - Vencimentos: Setembro e Outubro 2025
   - Status: 6 pendentes, 3 recebidas, 1 vencida

**Crit√©rio de Sucesso:**
- [ ] 5 fornecedores criados
- [ ] 10 contas a pagar criadas
- [ ] 5 clientes criados
- [ ] 10 contas a receber criadas
- [ ] Dashboard financeiro exibe dados corretos

---

#### **2.3 - Propostas Comerciais**

**Status Atual:** 0 propostas

**A√ß√£o:**
1. Criar **5 propostas** comerciais:
   - Cliente: Clientes cadastrados no financeiro
   - Servi√ßo: Constru√ß√£o, Reforma, Manuten√ß√£o
   - Valor: R$ 10.000 a R$ 200.000
   - Status: 2 pendentes, 2 aprovadas, 1 recusada

2. Para propostas aprovadas:
   - Verificar se obra foi criada automaticamente
   - Verificar se conta a receber foi criada

**Crit√©rio de Sucesso:**
- [ ] 5 propostas criadas
- [ ] 2 obras criadas automaticamente
- [ ] 2 contas a receber criadas automaticamente
- [ ] Integra√ß√£o Proposta ‚Üí Obra ‚Üí Financeiro funcionando

---

### **PRIORIDADE 3: TESTAR INTEGRA√á√ïES N√ÉO VALIDADAS** üü¢

#### **3.1 - Almoxarifado ‚Üí Custos**

**A√ß√£o:**
1. Registrar sa√≠da de material para obra
2. Verificar se custo foi criado automaticamente na obra
3. Validar valor do custo (quantidade √ó valor unit√°rio)
4. Validar categoria do custo

**Crit√©rio de Sucesso:**
- [ ] Sa√≠da de material cria custo automaticamente
- [ ] Valor do custo est√° correto
- [ ] Obra associada corretamente
- [ ] Categoria "Material" aplicada

---

#### **3.2 - Almoxarifado ‚Üí Financeiro**

**A√ß√£o:**
1. Registrar entrada de material com fornecedor
2. Verificar se conta a pagar foi criada automaticamente
3. Validar valor da conta (total da nota fiscal)
4. Validar fornecedor associado

**Crit√©rio de Sucesso:**
- [ ] Entrada de material cria conta a pagar
- [ ] Valor da conta est√° correto
- [ ] Fornecedor associado corretamente
- [ ] Vencimento preenchido

---

#### **3.3 - Financeiro ‚Üí Contabilidade**

**A√ß√£o:**
1. Pagar uma conta a pagar
2. Verificar se lan√ßamento cont√°bil foi criado
3. Validar partidas dobradas:
   - **D** - Fornecedores (passivo diminui)
   - **C** - Caixa/Banco (ativo diminui)

4. Receber uma conta a receber
5. Verificar se lan√ßamento cont√°bil foi criado
6. Validar partidas dobradas:
   - **D** - Caixa/Banco (ativo aumenta)
   - **C** - Contas a Receber (ativo diminui)

**Crit√©rio de Sucesso:**
- [ ] Pagamento cria lan√ßamento cont√°bil
- [ ] Recebimento cria lan√ßamento cont√°bil
- [ ] Partidas dobradas corretas em ambos
- [ ] Contas cont√°beis corretas

---

### **PRIORIDADE 4: TESTAR M√ìDULOS N√ÉO TESTADOS** üîµ

#### **4.1 - RDO (Relat√≥rio Di√°rio de Obra)**

**A√ß√£o:**
1. Criar **3 RDOs** para obras diferentes
2. Adicionar subatividades (ex: "Alvenaria", "Concretagem")
3. Registrar m√£o de obra (funcion√°rios alocados)
4. Registrar equipamentos utilizados
5. Listar RDOs por obra
6. Filtrar RDOs por per√≠odo

**Crit√©rio de Sucesso:**
- [ ] 3 RDOs criados
- [ ] Subatividades adicionadas
- [ ] M√£o de obra registrada
- [ ] Equipamentos registrados
- [ ] Listagem e filtros funcionando

---

#### **4.2 - Alimenta√ß√£o**

**A√ß√£o:**
1. Registrar **20 refei√ß√µes** para funcion√°rios
2. Distribuir entre Setembro e Outubro 2025
3. Associar a obras diferentes
4. Calcular custo total por funcion√°rio
5. Calcular custo total por obra
6. Gerar relat√≥rio de alimenta√ß√£o

**Crit√©rio de Sucesso:**
- [ ] 20 refei√ß√µes registradas
- [ ] Custos por funcion√°rio corretos
- [ ] Custos por obra corretos
- [ ] Relat√≥rio gerado com sucesso

---

#### **4.3 - Frota (Aprofundar)**

**A√ß√£o:**
1. Criar **3 ve√≠culos** adicionais
2. Registrar **10 usos** de ve√≠culos em obras
3. Registrar **5 abastecimentos** com custos
4. Registrar **2 manuten√ß√µes**
5. Calcular custo total por ve√≠culo
6. Gerar relat√≥rio de frota

**Crit√©rio de Sucesso:**
- [ ] 4 ve√≠culos cadastrados (total)
- [ ] 10 usos registrados
- [ ] 5 abastecimentos registrados
- [ ] 2 manuten√ß√µes registradas
- [ ] Custos calculados corretamente
- [ ] Relat√≥rio gerado

---

### **PRIORIDADE 5: VALIDA√á√ïES E SEGURAN√áA** üîí

#### **5.1 - Valida√ß√µes de Formul√°rio**

**A√ß√£o:**
Testar valida√ß√µes em todos os formul√°rios:

1. **CPF/CNPJ:**
   - [ ] Tentar cadastrar funcion√°rio com CPF inv√°lido
   - [ ] Tentar cadastrar fornecedor com CNPJ inv√°lido

2. **Datas:**
   - [ ] Tentar criar folha com data futura
   - [ ] Tentar registrar ponto com data futura

3. **Valores Num√©ricos:**
   - [ ] Tentar criar conta com valor negativo
   - [ ] Tentar criar sal√°rio com valor zero

4. **Campos Obrigat√≥rios:**
   - [ ] Tentar criar funcion√°rio sem nome
   - [ ] Tentar criar obra sem c√≥digo

**Crit√©rio de Sucesso:**
- [ ] Todas as valida√ß√µes funcionando
- [ ] Mensagens de erro claras
- [ ] Formul√°rio n√£o submete dados inv√°lidos

---

#### **5.2 - Permiss√µes de Acesso**

**A√ß√£o:**
1. Criar usu√°rio **Funcion√°rio** (n√£o admin)
2. Tentar acessar:
   - [ ] Dashboard principal (deve bloquear)
   - [ ] Perfil pr√≥prio (deve permitir)
   - [ ] Dados de outros funcion√°rios (deve bloquear)
   - [ ] Folha de pagamento (deve bloquear)

3. Criar usu√°rio **Gestor de Equipes**
4. Tentar acessar:
   - [ ] Equipe (deve permitir)
   - [ ] Ponto (deve permitir)
   - [ ] Financeiro (deve bloquear)

**Crit√©rio de Sucesso:**
- [ ] Permiss√µes corretas por tipo de usu√°rio
- [ ] Redirecionamento para login quando n√£o autorizado
- [ ] Mensagens de erro apropriadas

---

### **PRIORIDADE 6: PERFORMANCE E OTIMIZA√á√ÉO** ‚ö°

#### **6.1 - Teste de Carga**

**A√ß√£o:**
1. Criar **100 funcion√°rios** adicionais
2. Criar **500 registros de ponto** para Outubro/2025
3. Processar folha de Outubro com 105 funcion√°rios
4. Medir tempo de processamento
5. Verificar uso de mem√≥ria

**Crit√©rio de Sucesso:**
- [ ] Processamento completa em < 30 segundos
- [ ] Sem erros de mem√≥ria
- [ ] Queries otimizadas (sem N+1)

---

#### **6.2 - Cache de Feriados**

**A√ß√£o:**
1. Verificar se `CalendarioUtil` est√° cacheando feriados
2. Processar folha de 10 funcion√°rios
3. Verificar logs: deve buscar feriados apenas 1 vez
4. Implementar cache se necess√°rio

**Crit√©rio de Sucesso:**
- [ ] Feriados buscados apenas 1 vez por ano
- [ ] Redu√ß√£o de 20% no tempo de processamento

---

## üìã CHECKLIST FINAL DE VALIDA√á√ÉO

Ap√≥s completar todas as tarefas, validar:

### **M√≥dulos 100% Funcionais:**
- [ ] Dashboard Principal
- [ ] RH (Funcion√°rios, Departamentos, Fun√ß√µes)
- [ ] Obras
- [ ] Equipe
- [ ] Ponto Eletr√¥nico
- [ ] RDO
- [ ] Frota
- [ ] Alimenta√ß√£o
- [ ] Almoxarifado
- [ ] Financeiro
- [ ] Custos
- [ ] Contabilidade
- [ ] Folha de Pagamento
- [ ] Propostas Comerciais
- [ ] Configura√ß√µes

### **Integra√ß√µes 100% Funcionais:**
- [ ] Folha ‚Üí Contabilidade
- [ ] Financeiro ‚Üí Contabilidade
- [ ] Almoxarifado ‚Üí Custos
- [ ] Almoxarifado ‚Üí Financeiro
- [ ] Propostas ‚Üí Obras ‚Üí Financeiro
- [ ] Ponto ‚Üí Folha

### **Valida√ß√µes e Seguran√ßa:**
- [ ] Multi-tenancy testado
- [ ] Valida√ß√µes de formul√°rio testadas
- [ ] Permiss√µes de acesso testadas
- [ ] Rotas protegidas validadas

### **Performance:**
- [ ] Dashboards < 2s
- [ ] Problema N+1 resolvido
- [ ] Teste de carga com 100+ funcion√°rios
- [ ] Cache implementado

---

## üéØ RESULTADO ESPERADO

Ap√≥s executar este prompt, o sistema deve atingir:

‚úÖ **Taxa de sucesso:** 95%+  
‚úÖ **M√≥dulos 100% funcionais:** 15/15 (100%)  
‚úÖ **Integra√ß√µes validadas:** 6/6 (100%)  
‚úÖ **Dados de teste completos:** Todos os m√≥dulos  
‚úÖ **Status:** **PRONTO PARA PRODU√á√ÉO**  

---

## üìä RELAT√ìRIO FINAL

Ap√≥s completar os testes, gerar um **novo relat√≥rio** com:

1. Status atualizado de cada m√≥dulo
2. Resultados dos testes de integra√ß√£o
3. Bugs encontrados e corrigidos
4. M√©tricas de performance
5. Conclus√£o final com confian√ßa de deploy

**Formato:** Markdown (mesmo formato do relat√≥rio anterior)

---

**Pronto para finalizar os testes e levar o sistema a 100%!** üöÄ

