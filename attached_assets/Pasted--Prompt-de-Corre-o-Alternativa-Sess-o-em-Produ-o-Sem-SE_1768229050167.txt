# Prompt de Correção Alternativa: Sessão em Produção (Sem SERVER_NAME)

## Prompt para o Replit Agent

Cole o texto abaixo diretamente no chat do Replit Agent.

```
**AÇÃO DE CORREÇÃO URGENTE: Reversão e Correção de Sessão em Produção**

**Contexto e Diagnóstico:**

-   **Problema Atual:** Após a última alteração, a aplicação está inutilizável em produção. Qualquer clique em qualquer módulo redireciona para a tela de login. A sessão está sendo perdida em todas as requisições.
-   **Causa Raiz Provável:** A configuração `SERVER_NAME` que adicionamos entrou em conflito com o proxy reverso do Easypanel, quebrando a geração de URLs e invalidando a sessão de forma global. Esta configuração foi muito restritiva.

**Sua Tarefa:**

Reverta a configuração anterior e aplique uma solução alternativa mais robusta e menos invasiva. Vamos remover o `SERVER_NAME` e, em vez disso, especificar o domínio do cookie diretamente.

**Passo 1: Remova a Configuração Antiga**

-   **Ação:** No arquivo `main.py`, localize e **delete completamente** o bloco de configuração de produção que adicionamos anteriormente (o bloco que começa com `if IS_PRODUCTION:`).

**Passo 2: Aplique a Nova Configuração Consolidada**

-   **Ação:** No mesmo lugar onde você deletou o bloco antigo (logo após a linha do `ProxyFix`), adicione a **nova configuração** abaixo. Ela é mais segura e não usa `SERVER_NAME`.

```python
# ... (após a linha app.wsgi_app = ProxyFix(...))

# ======================================================================
# == NOVA CONFIGURAÇÃO DE PRODUÇÃO (Alternativa sem SERVER_NAME) ==
# ======================================================================

# 1. Detecção de Ambiente de Produção
import os
IS_PRODUCTION = 'REPL_ID' not in os.environ

# 2. Aplica configurações de sessão APENAS em produção
if IS_PRODUCTION:
    app.config.update(
        # SESSION_COOKIE_DOMAIN: Define o domínio para o qual o cookie é válido.
        # O ponto no início faz com que seja válido para 'sige.cassioviller.tech' e 'www.sige.cassioviller.tech'.
        # ESTA É A CORREÇÃO MAIS IMPORTANTE.
        SESSION_COOKIE_DOMAIN=".sige.cassioviller.tech",
        
        # SESSION_COOKIE_SECURE: Garante que o cookie só seja enviado via HTTPS.
        SESSION_COOKIE_SECURE=True,
        
        # SESSION_COOKIE_HTTPONLY: Previne que o cookie de sessão seja acessado por JavaScript.
        SESSION_COOKIE_HTTPONLY=True,
        
        # SESSION_COOKIE_SAMESITE: Mitiga ataques CSRF.
        SESSION_COOKIE_SAMESITE="Lax"
    )

# ======================================================================
# == FIM DA NOVA CONFIGURAÇÃO DE PRODUÇÃO ==
# ======================================================================

# ... (resto do código, como a inicialização do CSRFProtect, etc.)
```

**Resumo da Ação:**

1.  Você irá **remover** a configuração `SERVER_NAME` que estava causando o problema.
2.  Você irá adicionar a configuração `SESSION_COOKIE_DOMAIN=".sige.cassioviller.tech"`. Esta é uma forma mais direta e segura de garantir que o cookie de sessão seja válido para o seu domínio e todos os seus subdomínios (como `www`).

**Instruções para Mim (após você aplicar o código):**

1.  Eu farei o deploy deste novo código no Easypanel.
2.  Vou limpar os cookies do meu navegador **completamente**.
3.  Vou testar o fluxo de login e navegação entre os módulos.

**Execute a correção alternativa agora.**
```
