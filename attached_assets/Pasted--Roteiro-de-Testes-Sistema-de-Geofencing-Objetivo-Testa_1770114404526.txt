# ğŸ§ª Roteiro de Testes - Sistema de Geofencing

## ğŸ¯ Objetivo
Testar o sistema de Cerca Virtual (Geofencing) diretamente no aplicativo para garantir que estÃ¡ funcionando corretamente.

---

## ğŸ“‹ TESTE 1: Configurar Geofencing em uma Obra

### Passos:
1. Acesse o menu **Obras**
2. Clique em **Editar** em uma obra existente (ou crie uma nova)
3. Role atÃ© a seÃ§Ã£o **"Geofencing (Cerca Virtual)"**
4. Clique no botÃ£o **"Obter LocalizaÃ§Ã£o Atual"**
5. Verifique se os campos foram preenchidos:
   - **Latitude**: deve ter um nÃºmero (ex: -23.550520)
   - **Longitude**: deve ter um nÃºmero (ex: -46.633308)
   - **Raio**: deixe 100 metros (padrÃ£o)
6. Clique em **Salvar**

### âœ… Resultado Esperado:
- Obra salva com sucesso
- Coordenadas GPS armazenadas no banco de dados
- Mensagem de confirmaÃ§Ã£o exibida

---

## ğŸ“‹ TESTE 2: Registrar Ponto DENTRO do Raio (Deve Funcionar)

### CenÃ¡rio:
Simular que o funcionÃ¡rio estÃ¡ na mesma localizaÃ§Ã£o da obra (distÃ¢ncia = 0m)

### Passos:
1. Acesse o menu **Ponto EletrÃ´nico Facial AutomÃ¡tico**
2. Permita acesso Ã  cÃ¢mera e Ã  localizaÃ§Ã£o quando solicitado
3. Tire uma foto do rosto do funcionÃ¡rio
4. Aguarde o sistema processar

### âœ… Resultado Esperado:
- âœ… Reconhecimento facial bem-sucedido
- âœ… ValidaÃ§Ã£o de localizaÃ§Ã£o aprovada
- âœ… Ponto registrado com sucesso
- âœ… Mensagem: "Ponto registrado com sucesso! DistÃ¢ncia: 0m" (ou prÃ³ximo de 0)

---

## ğŸ“‹ TESTE 3: Registrar Ponto SEM Enviar GPS (Deve Falhar)

### CenÃ¡rio:
Simular tentativa de burlar o sistema nÃ£o enviando localizaÃ§Ã£o

### Passos:
1. Acesse o **Ponto EletrÃ´nico Facial AutomÃ¡tico**
2. **BLOQUEIE** o acesso Ã  localizaÃ§Ã£o no navegador quando solicitado
3. Tente tirar a foto

### âœ… Resultado Esperado:
- âŒ Sistema deve recusar o registro
- âŒ Mensagem de erro: "VocÃª precisa permitir o acesso Ã  localizaÃ§Ã£o para registrar o ponto"
- âŒ Ponto NÃƒO deve ser registrado

---

## ğŸ“‹ TESTE 4: Modificar Coordenadas Manualmente (Simular Fora do Raio)

### CenÃ¡rio:
Testar validaÃ§Ã£o quando funcionÃ¡rio estÃ¡ longe da obra

### Passos:
1. Acesse o menu **Obras**
2. Edite a obra que tem geofencing configurado
3. **Modifique** as coordenadas para um local distante:
   - **Latitude**: -22.906847 (Rio de Janeiro)
   - **Longitude**: -43.172896 (Rio de Janeiro)
   - **Raio**: 100 metros
4. Salve a obra
5. Tente registrar o ponto novamente (vocÃª ainda estÃ¡ em SÃ£o Paulo)

### âœ… Resultado Esperado:
- âŒ Sistema deve recusar o registro
- âŒ Mensagem de erro: "VocÃª estÃ¡ fora da Ã¡rea da obra. Fora do raio (XXXkm de 100m)"
- âŒ Ponto NÃƒO deve ser registrado

---

## ğŸ“‹ TESTE 5: Obra SEM Geofencing (Compatibilidade Retroativa)

### CenÃ¡rio:
Garantir que obras antigas sem geofencing continuam funcionando

### Passos:
1. Acesse o menu **Obras**
2. Edite uma obra
3. **APAGUE** os valores de Latitude e Longitude (deixe em branco)
4. Salve a obra
5. Tente registrar o ponto nesta obra

### âœ… Resultado Esperado:
- âœ… Ponto deve ser registrado normalmente
- âœ… Sistema NÃƒO deve exigir localizaÃ§Ã£o
- âœ… Mensagem: "Ponto registrado com sucesso!"
- âœ… Funciona como antes (compatibilidade retroativa)

---

## ğŸ“‹ TESTE 6: Raio Grande (500m)

### CenÃ¡rio:
Testar com raio maior para obras grandes

### Passos:
1. Edite a obra
2. Configure:
   - **Latitude/Longitude**: Use "Obter LocalizaÃ§Ã£o Atual"
   - **Raio**: 500 metros
3. Salve
4. Registre o ponto

### âœ… Resultado Esperado:
- âœ… Ponto registrado com sucesso
- âœ… Aceita funcionÃ¡rios atÃ© 500m de distÃ¢ncia

---

## ğŸ“‹ TESTE 7: Raio Pequeno (10m)

### CenÃ¡rio:
Testar com raio muito restrito

### Passos:
1. Edite a obra
2. Configure:
   - **Latitude/Longitude**: Use "Obter LocalizaÃ§Ã£o Atual"
   - **Raio**: 10 metros
3. Salve
4. Registre o ponto

### âœ… Resultado Esperado:
- Se estiver exatamente no local: âœ… Aceita
- Se estiver a mais de 10m: âŒ Recusa

---

## ğŸ“‹ TESTE 8: Verificar Auditoria no Banco de Dados

### Passos:
1. ApÃ³s registrar alguns pontos com geofencing
2. Acesse o banco de dados PostgreSQL
3. Execute a query:
```sql
SELECT 
    funcionario_id,
    data,
    hora_entrada,
    latitude,
    longitude,
    distancia_obra_metros
FROM registro_ponto
WHERE latitude IS NOT NULL
ORDER BY created_at DESC
LIMIT 10;
```

### âœ… Resultado Esperado:
- Deve mostrar os registros com:
  - **latitude**: coordenadas do funcionÃ¡rio
  - **longitude**: coordenadas do funcionÃ¡rio
  - **distancia_obra_metros**: distÃ¢ncia calculada (ex: 0, 50, 100)

---

## ğŸ“Š Checklist de ValidaÃ§Ã£o

Marque cada teste conforme for executando:

- [ ] **TESTE 1**: Configurar geofencing em obra
- [ ] **TESTE 2**: Registrar ponto dentro do raio (ACEITO)
- [ ] **TESTE 3**: Tentar registrar sem GPS (RECUSADO)
- [ ] **TESTE 4**: Registrar fora do raio (RECUSADO)
- [ ] **TESTE 5**: Obra sem geofencing (ACEITO - retroativo)
- [ ] **TESTE 6**: Raio grande 500m (ACEITO)
- [ ] **TESTE 7**: Raio pequeno 10m (RESTRITO)
- [ ] **TESTE 8**: Verificar auditoria no banco

---

## ğŸ¯ Resultado Final Esperado

Se todos os 8 testes passarem:

âœ… **Sistema de Geofencing estÃ¡ funcionando perfeitamente!**

Funcionalidades validadas:
- âœ… Captura de GPS automÃ¡tica
- âœ… ValidaÃ§Ã£o de distÃ¢ncia correta
- âœ… Bloqueio de registros fora do raio
- âœ… Obrigatoriedade de GPS quando obra tem cerca virtual
- âœ… Compatibilidade retroativa (obras sem geofencing)
- âœ… Auditoria completa no banco de dados
- âœ… SeguranÃ§a contra burla (nÃ£o pode omitir GPS)

---

## ğŸ’¡ Dicas para o Teste

1. **Use o Chrome ou Edge** (melhor suporte a geolocalizaÃ§Ã£o)
2. **Permita acesso Ã  localizaÃ§Ã£o** quando o navegador solicitar
3. **Teste em dispositivo mÃ³vel** para GPS mais preciso
4. **Anote as distÃ¢ncias** mostradas nas mensagens para validar cÃ¡lculos

---

## ğŸ› Problemas Comuns

### "Navegador nÃ£o suporta geolocalizaÃ§Ã£o"
**SoluÃ§Ã£o**: Use Chrome, Edge ou Firefox atualizado

### "PermissÃ£o negada"
**SoluÃ§Ã£o**: VÃ¡ em ConfiguraÃ§Ãµes do navegador â†’ PermissÃµes â†’ LocalizaÃ§Ã£o â†’ Permitir

### "Erro ao obter localizaÃ§Ã£o"
**SoluÃ§Ã£o**: Ative o GPS do dispositivo ou use Wi-Fi (melhor precisÃ£o)

---

ğŸš€ **Pronto para testar! Execute os 8 testes na ordem e valide o sistema completo!**
