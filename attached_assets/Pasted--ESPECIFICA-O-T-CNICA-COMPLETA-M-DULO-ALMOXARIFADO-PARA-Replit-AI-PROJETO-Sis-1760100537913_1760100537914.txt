# ğŸ“‹ ESPECIFICAÃ‡ÃƒO TÃ‰CNICA COMPLETA - MÃ“DULO ALMOXARIFADO

**PARA:** Replit AI  
**PROJETO:** Sistema SIGE (EnterpriseSync) - MÃ³dulo Almoxarifado  
**VERSÃƒO:** 3.0 Simplificado  
**DATA:** Outubro 2025

---

## 1. VISÃƒO GERAL DO MÃ“DULO

### 1.1 PROPÃ“SITO
O **MÃ³dulo de Almoxarifado** Ã© um sistema completo de gestÃ£o de materiais, ferramentas e EPIs para empresas de construÃ§Ã£o civil. Ele controla entrada, saÃ­da, devoluÃ§Ã£o e estoque de itens, com rastreabilidade total e integraÃ§Ã£o nativa ao sistema SIGE.

### 1.2 OBJETIVOS PRINCIPAIS
- **Controlar estoque** de materiais, ferramentas e EPIs
- **Rastrear movimentaÃ§Ãµes** (entrada, saÃ­da, devoluÃ§Ã£o)
- **Gerenciar responsabilidades** (quem estÃ¡ com cada item)
- **Controlar custos** por obra/centro de custo
- **Alertar sobre** estoque baixo e validades
- **Gerar relatÃ³rios** essenciais para gestÃ£o

### 1.3 USUÃRIOS ALVO
- **Almoxarife:** Controla entrada/saÃ­da de materiais
- **Encarregado:** Solicita materiais para obras
- **Gestor:** Acompanha custos e relatÃ³rios
- **FuncionÃ¡rio:** Visualiza itens sob sua responsabilidade

---

## 2. FUNCIONALIDADES DETALHADAS

### 2.1 GESTÃƒO DE CATÃLOGO

#### 2.1.1 Categorias de Materiais
**Funcionalidade:** Organizar itens em categorias com configuraÃ§Ãµes padrÃ£o.

**Categorias PadrÃ£o:**
1. **EPIs** (Equipamentos de ProteÃ§Ã£o Individual)
   - Tipo padrÃ£o: SERIALIZADO
   - Permite devoluÃ§Ã£o: SIM
   - Exemplos: Capacetes, Ã³culos, botas

2. **Ferramentas**
   - Tipo padrÃ£o: SERIALIZADO
   - Permite devoluÃ§Ã£o: SIM
   - Exemplos: Furadeiras, martelos, chaves

3. **Materiais ElÃ©tricos**
   - Tipo padrÃ£o: CONSUMÃVEL
   - Permite devoluÃ§Ã£o: SIM (sobras)
   - Exemplos: Fios, cabos, disjuntores

4. **Materiais HidrÃ¡ulicos**
   - Tipo padrÃ£o: CONSUMÃVEL
   - Permite devoluÃ§Ã£o: SIM (sobras)
   - Exemplos: Tubos, conexÃµes, registros

5. **ConsumÃ­veis DescartÃ¡veis**
   - Tipo padrÃ£o: CONSUMÃVEL
   - Permite devoluÃ§Ã£o: NÃƒO
   - Exemplos: Luvas, mÃ¡scaras, eletrodos

#### 2.1.2 Cadastro de Itens
**Funcionalidade:** Cadastrar itens do almoxarifado com suas especificaÃ§Ãµes.

**Tipos de Controle:**
- **SERIALIZADO:** Itens Ãºnicos com nÃºmero de sÃ©rie (sempre podem ser devolvidos)
- **CONSUMÃVEL:** Materiais por quantidade (devoluÃ§Ã£o configurÃ¡vel)

**ConfiguraÃ§Ã£o de DevoluÃ§Ã£o:**
- **Serializados:** Sempre `permite_devolucao = True` (nÃ£o editÃ¡vel)
- **ConsumÃ­veis:** ConfigurÃ¡vel por item (`True` para sobras, `False` para descartÃ¡veis)

### 2.2 MOVIMENTAÃ‡Ã•ES

#### 2.2.1 Entrada de Materiais
**Funcionalidade:** Registrar entrada de novos materiais no estoque.

**Fluxos:**
- **Itens Serializados:** Informar nÃºmeros de sÃ©rie individuais
- **Itens ConsumÃ­veis:** Informar quantidade total

#### 2.2.2 SaÃ­da de Materiais
**Funcionalidade:** Registrar retirada de materiais por funcionÃ¡rios.

**Fluxos:**
- **Itens Serializados:** Selecionar itens especÃ­ficos por nÃºmero de sÃ©rie
- **Itens ConsumÃ­veis:** Informar quantidade a retirar

#### 2.2.3 DevoluÃ§Ã£o Inteligente
**Funcionalidade:** Processar devoluÃ§Ã£o baseada no tipo de item.

**Fluxos:**
- **Serializados:** DevoluÃ§Ã£o obrigatÃ³ria do item especÃ­fico
- **ConsumÃ­veis RetornÃ¡veis:** DevoluÃ§Ã£o opcional de sobras
- **ConsumÃ­veis DescartÃ¡veis:** NÃ£o permite devoluÃ§Ã£o

### 2.3 CONTROLE E RELATÃ“RIOS

#### 2.3.1 Dashboard Executivo
**Funcionalidade:** VisÃ£o geral do almoxarifado com KPIs essenciais.

#### 2.3.2 RelatÃ³rios Essenciais
**Funcionalidade:** 5 relatÃ³rios principais para gestÃ£o.

---

## 3. ESTRUTURA DE PÃGINAS E NAVEGAÃ‡ÃƒO

### 3.1 MENU PRINCIPAL
```
ALMOXARIFADO (Dropdown)
â”œâ”€â”€ ğŸ“Š Dashboard
â”œâ”€â”€ ğŸ“¦ CatÃ¡logo de Itens
â”œâ”€â”€ ğŸ·ï¸ Categorias
â”œâ”€â”€ â• Nova Entrada
â”œâ”€â”€ â– Nova SaÃ­da
â”œâ”€â”€ ğŸ”„ DevoluÃ§Ã£o
â”œâ”€â”€ ğŸ“‹ MovimentaÃ§Ãµes
â””â”€â”€ ğŸ“ˆ RelatÃ³rios
```

### 3.2 PÃGINAS DETALHADAS

#### 3.2.1 DASHBOARD (/almoxarifado/)
**PropÃ³sito:** VisÃ£o geral do almoxarifado com mÃ©tricas e aÃ§Ãµes rÃ¡pidas.

**SeÃ§Ãµes:**
1. **KPIs Principais** (Cards coloridos)
   - Total de Itens Ativos
   - Itens com Estoque Baixo
   - Movimentos do Dia
   - Valor Total do InventÃ¡rio

2. **AÃ§Ãµes RÃ¡pidas** (BotÃµes destacados)
   - Nova Entrada
   - Nova SaÃ­da
   - DevoluÃ§Ã£o

3. **Alertas Inteligentes**
   - Itens com estoque baixo
   - EPIs prÃ³ximos do vencimento
   - Itens sem movimentaÃ§Ã£o

4. **Ãšltimas MovimentaÃ§Ãµes** (Tabela resumida)
   - Data/Hora
   - Tipo de movimento
   - Item
   - FuncionÃ¡rio
   - Obra

**Layout:** Grid responsivo com cards Bootstrap 5

#### 3.2.2 CATÃLOGO DE ITENS (/almoxarifado/itens)
**PropÃ³sito:** Listar, buscar e gerenciar itens do catÃ¡logo.

**Funcionalidades:**
- **Busca Inteligente:** Por cÃ³digo ou nome
- **Filtros:** Categoria, tipo de controle, status
- **AÃ§Ãµes:** Visualizar, editar, entrada rÃ¡pida

**Campos Exibidos:**
- CÃ³digo do item
- Nome
- Categoria
- Tipo de controle
- Estoque atual
- Estoque mÃ­nimo
- Status (Normal/Baixo)
- AÃ§Ãµes

**Layout:** Tabela responsiva com filtros superiores

#### 3.2.3 NOVA ENTRADA (/almoxarifado/entrada)
**PropÃ³sito:** Registrar entrada de materiais no estoque.

**FormulÃ¡rio Principal:**
```
â”Œâ”€ DADOS GERAIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Item*: [Dropdown com busca]            â”‚
â”‚ Obra*: [Dropdown]                      â”‚
â”‚ Data Entrada*: [Date picker]           â”‚
â”‚ Valor UnitÃ¡rio*: [Number - R$]         â”‚
â”‚ Nota Fiscal: [Text]                    â”‚
â”‚ Lote: [Text]                           â”‚
â”‚ Data Validade: [Date picker]           â”‚
â”‚ ObservaÃ§Ãµes: [Textarea]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ DADOS ESPECÃFICOS (DinÃ¢mico) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SE SERIALIZADO:                        â”‚
â”‚   NÃºmeros de SÃ©rie*: [Textarea]        â”‚
â”‚   (Um por linha)                       â”‚
â”‚                                        â”‚
â”‚ SE CONSUMÃVEL:                         â”‚
â”‚   Quantidade*: [Number]                â”‚
â”‚   Unidade: [Text - readonly]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Cancelar] [Processar Entrada]
```

**ValidaÃ§Ãµes:**
- Item obrigatÃ³rio
- Obra obrigatÃ³ria
- Valor unitÃ¡rio > 0
- Se serializado: nÃºmeros de sÃ©rie Ãºnicos
- Se consumÃ­vel: quantidade > 0

**Comportamento:**
- Ao selecionar item, carrega tipo de controle
- Mostra campos especÃ­ficos dinamicamente
- Valida nÃºmeros de sÃ©rie em tempo real
- Calcula valor total automaticamente

#### 3.2.4 NOVA SAÃDA (/almoxarifado/saida)
**PropÃ³sito:** Registrar retirada de materiais por funcionÃ¡rios.

**FormulÃ¡rio Principal:**
```
â”Œâ”€ DADOS GERAIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FuncionÃ¡rio*: [Dropdown com busca]     â”‚
â”‚ Obra*: [Dropdown]                      â”‚
â”‚ Item*: [Dropdown com busca]            â”‚
â”‚ Data SaÃ­da*: [Date picker]             â”‚
â”‚ ObservaÃ§Ãµes: [Textarea]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ SELEÃ‡ÃƒO DE ITENS (DinÃ¢mico) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SE SERIALIZADO:                        â”‚
â”‚   Itens DisponÃ­veis: [Lista checkbox]  â”‚
â”‚   â˜ #12345 - Furadeira Bosch          â”‚
â”‚   â˜ #12346 - Furadeira Bosch          â”‚
â”‚                                        â”‚
â”‚ SE CONSUMÃVEL:                         â”‚
â”‚   Estoque DisponÃ­vel: 150 metros       â”‚
â”‚   Quantidade*: [Number]                â”‚
â”‚   Unidade: metros [readonly]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Cancelar] [Processar SaÃ­da]
```

**ValidaÃ§Ãµes:**
- FuncionÃ¡rio obrigatÃ³rio
- Obra obrigatÃ³ria
- Item obrigatÃ³rio
- Verificar disponibilidade em estoque
- Se serializado: pelo menos 1 item selecionado
- Se consumÃ­vel: quantidade <= estoque disponÃ­vel

**Comportamento:**
- Ao selecionar item, carrega estoque disponÃ­vel
- Mostra itens especÃ­ficos ou quantidade
- Valida disponibilidade em tempo real
- Atualiza estoque automaticamente

#### 3.2.5 DEVOLUÃ‡ÃƒO (/almoxarifado/devolucao)
**PropÃ³sito:** Processar devoluÃ§Ã£o de itens por funcionÃ¡rios.

**FormulÃ¡rio Principal:**
```
â”Œâ”€ SELEÃ‡ÃƒO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FuncionÃ¡rio*: [Dropdown]               â”‚
â”‚ Obra*: [Dropdown]                      â”‚
â”‚ [Buscar Itens]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ ITENS PARA DEVOLUÃ‡ÃƒO (DinÃ¢mico) â”€â”€â”€â”€â”€â”€â”
â”‚ Carregado via AJAX apÃ³s selecionar     â”‚
â”‚ funcionÃ¡rio                            â”‚
â”‚                                        â”‚
â”‚ SERIALIZADOS:                          â”‚
â”‚ â˜ Furadeira #12345                     â”‚
â”‚   CondiÃ§Ã£o: [Dropdown: Bom/Danificado]â”‚
â”‚                                        â”‚
â”‚ CONSUMÃVEIS RETORNÃVEIS:               â”‚
â”‚ â˜ Cabo 2,5mm - Retirado: 50m          â”‚
â”‚   Devolver: [Number] metros            â”‚
â”‚                                        â”‚
â”‚ ObservaÃ§Ãµes: [Textarea]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Cancelar] [Processar DevoluÃ§Ã£o]
```

**API de Apoio:**
```
GET /almoxarifado/api/itens-funcionario/{funcionario_id}
Retorna: Lista de itens que podem ser devolvidos
```

**ValidaÃ§Ãµes:**
- FuncionÃ¡rio obrigatÃ³rio
- Pelo menos 1 item selecionado
- Quantidade devolvida <= quantidade retirada
- CondiÃ§Ã£o obrigatÃ³ria para serializados

#### 3.2.6 MOVIMENTAÃ‡Ã•ES (/almoxarifado/movimentacoes)
**PropÃ³sito:** HistÃ³rico completo de movimentaÃ§Ãµes.

**Filtros:**
```
â”Œâ”€ FILTROS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PerÃ­odo: [Date] atÃ© [Date]             â”‚
â”‚ Tipo: [Dropdown: Todos/Entrada/SaÃ­da/  â”‚
â”‚        DevoluÃ§Ã£o]                      â”‚
â”‚ FuncionÃ¡rio: [Dropdown: Todos/...]     â”‚
â”‚ Obra: [Dropdown: Todos/...]            â”‚
â”‚ Item: [Busca]                          â”‚
â”‚ [Filtrar] [Limpar]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tabela de Resultados:**
- Data/Hora
- Tipo (badge colorido)
- Item
- FuncionÃ¡rio
- Obra
- Quantidade
- Valor
- UsuÃ¡rio responsÃ¡vel
- AÃ§Ãµes (ver detalhes)

**PaginaÃ§Ã£o:** 50 registros por pÃ¡gina

#### 3.2.7 RELATÃ“RIOS (/almoxarifado/relatorios)
**PropÃ³sito:** Central de relatÃ³rios essenciais.

**5 RelatÃ³rios Principais:**

1. **PosiÃ§Ã£o de Estoque**
   - Estoque atual por item/categoria
   - Valor total por categoria
   - Itens com estoque baixo

2. **MovimentaÃ§Ãµes por PerÃ­odo**
   - Entradas, saÃ­das e devoluÃ§Ãµes
   - Filtros por data, tipo, obra
   - Totalizadores

3. **Itens por FuncionÃ¡rio**
   - Responsabilidades atuais
   - Valor total por funcionÃ¡rio
   - Itens vencidos/vencendo

4. **Consumo por Obra**
   - Materiais consumidos por projeto
   - Custo total por obra
   - Ranking de consumo

5. **Alertas e PendÃªncias**
   - Estoque baixo
   - EPIs vencendo
   - Itens sem movimentaÃ§Ã£o

**Formato de ExportaÃ§Ã£o:**
- VisualizaÃ§Ã£o HTML
- Download Excel
- Download PDF

---

## 4. FLUXO DE DADOS DETALHADO

### 4.1 FLUXO DE ENTRADA

```
1. UsuÃ¡rio acessa /almoxarifado/entrada
2. Seleciona item â†’ AJAX carrega tipo de controle
3. Preenche dados gerais (obra, valor, data)
4. SE SERIALIZADO:
   - Informa nÃºmeros de sÃ©rie (textarea)
   - Sistema valida unicidade
5. SE CONSUMÃVEL:
   - Informa quantidade
   - Sistema valida > 0
6. Submete formulÃ¡rio â†’ POST /almoxarifado/processar-entrada
7. Sistema cria registros:
   - AlmoxarifadoEstoque (1 para cada item/lote)
   - AlmoxarifadoMovimento (registro da entrada)
8. Atualiza estoque automaticamente
9. Redireciona com mensagem de sucesso
```

### 4.2 FLUXO DE SAÃDA

```
1. UsuÃ¡rio acessa /almoxarifado/saida
2. Seleciona funcionÃ¡rio e obra
3. Seleciona item â†’ AJAX carrega estoque disponÃ­vel
4. SE SERIALIZADO:
   - Mostra lista de itens disponÃ­veis
   - UsuÃ¡rio seleciona itens especÃ­ficos
5. SE CONSUMÃVEL:
   - Mostra quantidade disponÃ­vel
   - UsuÃ¡rio informa quantidade a retirar
6. Sistema valida disponibilidade
7. Submete formulÃ¡rio â†’ POST /almoxarifado/processar-saida
8. Sistema atualiza:
   - AlmoxarifadoEstoque (status ou quantidade)
   - Cria AlmoxarifadoMovimento
9. Vincula itens ao funcionÃ¡rio
10. Redireciona com sucesso
```

### 4.3 FLUXO DE DEVOLUÃ‡ÃƒO

```
1. UsuÃ¡rio acessa /almoxarifado/devolucao
2. Seleciona funcionÃ¡rio â†’ AJAX busca itens em posse
3. GET /api/itens-funcionario/{id} retorna:
   - Itens serializados em posse
   - ConsumÃ­veis retornÃ¡veis com saldo
4. UsuÃ¡rio seleciona itens e quantidades
5. Submete formulÃ¡rio â†’ POST /almoxarifado/processar-devolucao
6. Sistema processa:
   - Atualiza status/quantidade no estoque
   - Cria movimento de devoluÃ§Ã£o
   - Remove vÃ­nculo com funcionÃ¡rio
7. Redireciona com sucesso
```

---

## 5. ESPECIFICAÃ‡ÃƒO DE CAMPOS

### 5.1 FORMULÃRIO DE ENTRADA

| Campo | Tipo | ObrigatÃ³rio | ValidaÃ§Ã£o | Comportamento |
|-------|------|-------------|-----------|---------------|
| **Item** | Dropdown | SIM | Deve existir e estar ativo | Carrega tipo de controle via AJAX |
| **Obra** | Dropdown | SIM | Deve existir e estar ativa | Lista obras do tenant |
| **Data Entrada** | Date | SIM | NÃ£o pode ser futura | PadrÃ£o: hoje |
| **Valor UnitÃ¡rio** | Number | SIM | > 0, formato R$ | MÃ¡scara monetÃ¡ria |
| **Nota Fiscal** | Text | NÃƒO | MÃ¡x 50 caracteres | - |
| **Lote** | Text | NÃƒO | MÃ¡x 50 caracteres | - |
| **Data Validade** | Date | NÃƒO | Deve ser futura | Apenas para EPIs |
| **ObservaÃ§Ãµes** | Textarea | NÃƒO | MÃ¡x 500 caracteres | - |
| **NÃºmeros de SÃ©rie** | Textarea | SIM* | Ãšnicos no sistema | *Apenas se SERIALIZADO |
| **Quantidade** | Number | SIM* | > 0 | *Apenas se CONSUMÃVEL |

### 5.2 FORMULÃRIO DE SAÃDA

| Campo | Tipo | ObrigatÃ³rio | ValidaÃ§Ã£o | Comportamento |
|-------|------|-------------|-----------|---------------|
| **FuncionÃ¡rio** | Dropdown | SIM | Deve existir e estar ativo | Lista funcionÃ¡rios do tenant |
| **Obra** | Dropdown | SIM | Deve existir e estar ativa | Lista obras do tenant |
| **Item** | Dropdown | SIM | Deve ter estoque > 0 | Carrega estoque via AJAX |
| **Data SaÃ­da** | Date | SIM | NÃ£o pode ser futura | PadrÃ£o: hoje |
| **ObservaÃ§Ãµes** | Textarea | NÃƒO | MÃ¡x 500 caracteres | - |
| **Itens Selecionados** | Checkbox | SIM* | Deve estar disponÃ­vel | *Apenas se SERIALIZADO |
| **Quantidade** | Number | SIM* | <= estoque disponÃ­vel | *Apenas se CONSUMÃVEL |

### 5.3 FORMULÃRIO DE DEVOLUÃ‡ÃƒO

| Campo | Tipo | ObrigatÃ³rio | ValidaÃ§Ã£o | Comportamento |
|-------|------|-------------|-----------|---------------|
| **FuncionÃ¡rio** | Dropdown | SIM | Deve ter itens em posse | Carrega itens via AJAX |
| **Obra** | Dropdown | SIM | Deve existir e estar ativa | Lista obras do tenant |
| **Itens Selecionados** | Checkbox | SIM | Deve estar com funcionÃ¡rio | Carregado dinamicamente |
| **CondiÃ§Ã£o** | Dropdown | SIM* | Bom/Danificado/Perdido | *Apenas para SERIALIZADO |
| **Quantidade Devolvida** | Number | SIM* | <= quantidade em posse | *Apenas para CONSUMÃVEL |
| **ObservaÃ§Ãµes** | Textarea | NÃƒO | MÃ¡x 500 caracteres | - |

---

## 6. PÃGINAS DE VISUALIZAÃ‡ÃƒO

### 6.1 DETALHES DO ITEM (/almoxarifado/item/{id})

**PropÃ³sito:** Visualizar informaÃ§Ãµes completas de um item.

**SeÃ§Ãµes:**
1. **InformaÃ§Ãµes BÃ¡sicas**
   - CÃ³digo, nome, categoria
   - Tipo de controle, permite devoluÃ§Ã£o
   - Estoque atual vs mÃ­nimo
   - Valor mÃ©dio

2. **Estoque Atual**
   - SE SERIALIZADO: Lista de nÃºmeros de sÃ©rie com status
   - SE CONSUMÃVEL: Quantidade total por lote

3. **HistÃ³rico de MovimentaÃ§Ãµes**
   - Ãšltimas 20 movimentaÃ§Ãµes
   - Filtro por tipo de movimento

4. **AÃ§Ãµes DisponÃ­veis**
   - Nova entrada
   - Editar item
   - RelatÃ³rio especÃ­fico

### 6.2 PERFIL DO FUNCIONÃRIO - ABA ALMOXARIFADO

**PropÃ³sito:** Mostrar itens em posse do funcionÃ¡rio.

**IntegraÃ§Ã£o:** Nova aba na pÃ¡gina de perfil do funcionÃ¡rio existente.

**ConteÃºdo:**
```
â”Œâ”€ ITENS EM POSSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SERIALIZADOS:                          â”‚
â”‚ ğŸ”§ Furadeira #12345 - Desde 15/10/25  â”‚
â”‚ ğŸ¦º Capacete #67890 - Desde 10/10/25   â”‚
â”‚                                        â”‚
â”‚ CONSUMÃVEIS:                           â”‚
â”‚ âš¡ Cabo 2,5mm - 25 metros              â”‚
â”‚ ğŸ”© Parafuso 6mm - 50 unidades          â”‚
â”‚                                        â”‚
â”‚ VALOR TOTAL: R$ 1.250,00               â”‚
â”‚                                        â”‚
â”‚ [Solicitar DevoluÃ§Ã£o]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 DASHBOARD DE OBRA - SEÃ‡ÃƒO ALMOXARIFADO

**PropÃ³sito:** Mostrar materiais alocados na obra.

**IntegraÃ§Ã£o:** Nova seÃ§Ã£o na pÃ¡gina de detalhes da obra.

**ConteÃºdo:**
- Valor total de materiais alocados
- Top 10 itens mais consumidos
- FuncionÃ¡rios com mais itens
- BotÃ£o para relatÃ³rio completo

---

## 7. APIS E INTEGRAÃ‡Ã•ES

### 7.1 APIS AJAX NECESSÃRIAS

```python
# Busca de itens com autocomplete
GET /almoxarifado/api/busca-itens?q={termo}
Response: [{"id": 1, "nome": "Furadeira", "codigo": "F001", "estoque": 5}]

# Detalhes do item para formulÃ¡rios
GET /almoxarifado/api/item/{id}
Response: {"tipo_controle": "SERIALIZADO", "estoque_atual": 5, "unidade": "un"}

# Estoque disponÃ­vel para saÃ­da
GET /almoxarifado/api/estoque-disponivel/{item_id}
Response: {"quantidade": 150, "itens_serializados": [{"id": 1, "numero_serie": "12345"}]}

# Itens em posse do funcionÃ¡rio
GET /almoxarifado/api/itens-funcionario/{funcionario_id}
Response: [{"estoque_id": 1, "item_nome": "Furadeira", "numero_serie": "12345"}]

# ValidaÃ§Ã£o de nÃºmero de sÃ©rie
POST /almoxarifado/api/validar-serie
Body: {"item_id": 1, "numero_serie": "12345"}
Response: {"valido": false, "erro": "NÃºmero jÃ¡ existe"}
```

### 7.2 INTEGRAÃ‡ÃƒO COM MÃ“DULOS EXISTENTES

**FuncionÃ¡rios:**
- Nova aba "Almoxarifado" no perfil
- API para listar itens em posse

**Obras:**
- Nova seÃ§Ã£o "Materiais" no dashboard
- RelatÃ³rio de consumo por obra

**Financeiro:**
- IntegraÃ§Ã£o de custos de materiais
- RelatÃ³rio de valor por centro de custo

---

## 8. REGRAS DE NEGÃ“CIO

### 8.1 CONTROLE DE ESTOQUE

1. **Itens Serializados:**
   - Cada item tem nÃºmero de sÃ©rie Ãºnico
   - Status: DISPONÃVEL, EM_USO, MANUTENÃ‡ÃƒO, DESCARTADO
   - Sempre podem ser devolvidos
   - Rastreamento individual completo

2. **Itens ConsumÃ­veis:**
   - Controle por quantidade
   - Podem ter sobras devolvidas (se configurado)
   - Controle por lote/data de entrada
   - FIFO automÃ¡tico na saÃ­da

### 8.2 MOVIMENTAÃ‡Ã•ES

1. **Entrada:**
   - Sempre vinculada a uma obra (centro de custo)
   - Valor unitÃ¡rio obrigatÃ³rio
   - Atualiza preÃ§o mÃ©dio automaticamente

2. **SaÃ­da:**
   - Sempre vinculada a funcionÃ¡rio e obra
   - Verifica disponibilidade antes de processar
   - Atualiza status/quantidade automaticamente

3. **DevoluÃ§Ã£o:**
   - Apenas itens que permitem devoluÃ§Ã£o
   - Registra condiÃ§Ã£o do item (para serializados)
   - Pode ser parcial (para consumÃ­veis)

### 8.3 ALERTAS E NOTIFICAÃ‡Ã•ES

1. **Estoque Baixo:**
   - Alerta quando estoque <= estoque mÃ­nimo
   - Exibido no dashboard
   - Pode gerar notificaÃ§Ã£o por email

2. **Validade de EPIs:**
   - Alerta 30 dias antes do vencimento
   - Controle automÃ¡tico por data de validade
   - RelatÃ³rio especÃ­fico

3. **Itens Sem MovimentaÃ§Ã£o:**
   - Identifica itens parados hÃ¡ mais de 90 dias
   - SugestÃ£o de remanejamento

---

## 9. VALIDAÃ‡Ã•ES E SEGURANÃ‡A

### 9.1 VALIDAÃ‡Ã•ES DE ENTRADA

- **Multi-tenancy:** Todos os dados isolados por `admin_id`
- **PermissÃµes:** Verificar se usuÃ¡rio pode acessar obra/funcionÃ¡rio
- **Integridade:** Validar FK antes de salvar
- **Unicidade:** NÃºmeros de sÃ©rie Ãºnicos por item

### 9.2 VALIDAÃ‡Ã•ES DE NEGÃ“CIO

- **Estoque:** NÃ£o permitir saÃ­da maior que disponÃ­vel
- **Datas:** NÃ£o permitir datas futuras em movimentaÃ§Ãµes
- **Status:** NÃ£o permitir saÃ­da de itens em manutenÃ§Ã£o
- **DevoluÃ§Ã£o:** Apenas itens que estÃ£o com o funcionÃ¡rio

### 9.3 AUDITORIA

- **Log de MovimentaÃ§Ãµes:** Todos os movimentos registrados
- **UsuÃ¡rio ResponsÃ¡vel:** Quem fez cada operaÃ§Ã£o
- **Timestamp:** Data/hora de cada aÃ§Ã£o
- **ObservaÃ§Ãµes:** Campo livre para justificativas

---

## 10. PERFORMANCE E OTIMIZAÃ‡ÃƒO

### 10.1 ÃNDICES NECESSÃRIOS

```sql
-- Consultas por item e status
CREATE INDEX idx_almox_estoque_item_status ON almoxarifado_estoque(item_id, status);

-- Consultas por funcionÃ¡rio
CREATE INDEX idx_almox_estoque_funcionario ON almoxarifado_estoque(funcionario_atual_id);

-- Consultas de movimentaÃ§Ã£o por data
CREATE INDEX idx_almox_movimento_data ON almoxarifado_movimento(data_movimento);

-- Busca por cÃ³digo/nome
CREATE INDEX idx_almox_item_busca ON almoxarifado_item(admin_id, codigo, nome);
```

### 10.2 CACHE E OTIMIZAÃ‡Ã•ES

- **Estoque Atual:** Cache de 5 minutos para cÃ¡lculos
- **Autocomplete:** Cache de resultados de busca
- **RelatÃ³rios:** Cache de 1 hora para relatÃ³rios pesados
- **PaginaÃ§Ã£o:** MÃ¡ximo 50 registros por pÃ¡gina

---

## 11. CRONOGRAMA DE IMPLEMENTAÃ‡ÃƒO

### FASE 1: BACKEND (2-3 dias)
- [ ] Criar modelos de dados
- [ ] Implementar migraÃ§Ã£o
- [ ] Criar blueprint bÃ¡sico
- [ ] Implementar APIs AJAX
- [ ] Testes unitÃ¡rios

### FASE 2: FRONTEND BÃSICO (2-3 dias)
- [ ] Dashboard principal
- [ ] FormulÃ¡rios de entrada/saÃ­da
- [ ] Listagem de itens
- [ ] IntegraÃ§Ã£o AJAX

### FASE 3: FUNCIONALIDADES AVANÃ‡ADAS (2-3 dias)
- [ ] DevoluÃ§Ã£o inteligente
- [ ] RelatÃ³rios essenciais
- [ ] IntegraÃ§Ã£o com perfil funcionÃ¡rio
- [ ] Alertas automÃ¡ticos

### FASE 4: REFINAMENTOS (1-2 dias)
- [ ] OtimizaÃ§Ãµes de performance
- [ ] ValidaÃ§Ãµes completas
- [ ] Testes de integraÃ§Ã£o
- [ ] DocumentaÃ§Ã£o

**TOTAL ESTIMADO: 7-11 dias**

---

## 12. CRITÃ‰RIOS DE ACEITAÃ‡ÃƒO

### 12.1 FUNCIONALIDADES OBRIGATÃ“RIAS
- [ ] Entrada de itens serializados e consumÃ­veis
- [ ] SaÃ­da com verificaÃ§Ã£o de estoque
- [ ] DevoluÃ§Ã£o baseada no tipo de item
- [ ] Dashboard com KPIs corretos
- [ ] RelatÃ³rios essenciais funcionando
- [ ] IntegraÃ§Ã£o com perfil do funcionÃ¡rio

### 12.2 PERFORMANCE
- [ ] Carregamento de pÃ¡ginas < 2 segundos
- [ ] Busca de itens < 1 segundo
- [ ] RelatÃ³rios < 5 segundos
- [ ] Interface responsiva em mobile

### 12.3 QUALIDADE
- [ ] Multi-tenancy funcionando
- [ ] ValidaÃ§Ãµes completas
- [ ] Tratamento de erros
- [ ] Logs de auditoria
- [ ] CÃ³digo documentado

---

**ESTE DOCUMENTO SERVE COMO ESPECIFICAÃ‡ÃƒO COMPLETA PARA IMPLEMENTAÃ‡ÃƒO DO MÃ“DULO DE ALMOXARIFADO NO SISTEMA SIGE. TODAS AS FUNCIONALIDADES, FLUXOS E VALIDAÃ‡Ã•ES ESTÃƒO DETALHADAMENTE ESPECIFICADOS PARA FACILITAR O DESENVOLVIMENTO.**
