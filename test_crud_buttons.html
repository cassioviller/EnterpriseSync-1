<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste CRUD Custos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-dark text-white">
    <div class="container mt-5">
        <h1>Teste CRUD de Custos de Ve√≠culos</h1>
        
        <div class="alert alert-info">
            <h5>Status dos Testes:</h5>
            <div id="status-logs"></div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Teste das APIs</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-2" onclick="testarObrasAPI()">Testar API Obras</button>
                        <button class="btn btn-success mb-2" onclick="testarCustoAPI()">Testar API Custo</button>
                        <button class="btn btn-warning mb-2" onclick="simularEdicao()">Simular Edi√ß√£o</button>
                        <button class="btn btn-danger mb-2" onclick="simularExclusao()">Simular Exclus√£o</button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Simular Tabela com Bot√µes</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-dark">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Tipo</th>
                                    <th>Valor</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>01/08/2025</td>
                                    <td>Combust√≠vel</td>
                                    <td>R$ 180,50</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <button type="button" class="btn btn-outline-primary" 
                                                    onclick="editarCusto(1)" title="Editar">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-danger" 
                                                    onclick="excluirCusto(1, 'combustivel', 180.50)" title="Excluir">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function log(message) {
            const logsDiv = document.getElementById('status-logs');
            logsDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        }

        function testarObrasAPI() {
            log('üß™ Testando API /api/obras-disponiveis...');
            
            fetch('/api/obras-disponiveis')
                .then(response => {
                    log('üìä Status: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    log('üìä Resultado: ' + JSON.stringify(data));
                    if (data.success) {
                        log('‚úÖ API Obras funcionando! ' + data.obras.length + ' obras encontradas');
                    } else {
                        log('‚ùå Erro: ' + data.message);
                    }
                })
                .catch(error => {
                    log('‚ùå Erro na requisi√ß√£o: ' + error);
                });
        }

        function testarCustoAPI() {
            log('üß™ Testando API de custo...');
            
            // Usar ID de custo real da base
            const custoId = 33; // ID encontrado nos testes
            
            fetch(`/api/custos-veiculo/${custoId}`)
                .then(response => {
                    log('üí∞ Status: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    log('üí∞ Resultado: ' + JSON.stringify(data));
                    if (data.success) {
                        log('‚úÖ API Custo funcionando! Custo ID ' + data.dados.id + ' encontrado');
                    } else {
                        log('‚ùå Erro: ' + data.message);
                    }
                })
                .catch(error => {
                    log('‚ùå Erro na requisi√ß√£o: ' + error);
                });
        }

        function editarCusto(id) {
            log('üîß Fun√ß√£o editarCusto chamada com ID: ' + id);
            
            try {
                // Simular a l√≥gica completa
                fetch('/api/obras-disponiveis')
                    .then(response => {
                        log('üìä Carregando obras... Status: ' + response.status);
                        return response.json();
                    })
                    .then(obrasData => {
                        log('üìä Obras carregadas: ' + JSON.stringify(obrasData));
                        
                        if (obrasData.success) {
                            log('‚úÖ Obras OK, carregando dados do custo...');
                            
                            return fetch(`/api/custos-veiculo/33`); // ID real
                        }
                    })
                    .then(response => {
                        log('üí∞ Dados do custo... Status: ' + response.status);
                        return response.json();
                    })
                    .then(data => {
                        log('üí∞ Dados recebidos: ' + JSON.stringify(data));
                        
                        if (data.success) {
                            log('‚úÖ Tudo funcionando! Modal seria aberto normalmente.');
                            alert('Edi√ß√£o simulada com sucesso! Dados carregados corretamente.');
                        } else {
                            log('‚ùå Erro nos dados: ' + data.message);
                        }
                    })
                    .catch(error => {
                        log('‚ùå Erro na simula√ß√£o: ' + error);
                    });
            } catch (error) {
                log('‚ùå Erro geral: ' + error);
            }
        }

        function excluirCusto(id, tipo, valor) {
            log('üóëÔ∏è Fun√ß√£o excluirCusto chamada: ID=' + id + ', Tipo=' + tipo + ', Valor=' + valor);
            
            if (confirm(`Tem certeza que deseja excluir este custo de ${tipo} (R$ ${valor.toFixed(2)})?`)) {
                log('‚úÖ Confirma√ß√£o recebida, executando exclus√£o...');
                
                fetch(`/api/custos-veiculo/33`, {  // ID real para teste
                    method: 'DELETE'
                })
                .then(response => {
                    log('üóëÔ∏è Status da exclus√£o: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    log('üóëÔ∏è Resultado: ' + JSON.stringify(data));
                    
                    if (data.success) {
                        log('‚úÖ Exclus√£o simulada com sucesso!');
                        alert('Exclus√£o simulada! Em produ√ß√£o, a p√°gina seria recarregada.');
                    } else {
                        log('‚ùå Erro na exclus√£o: ' + data.message);
                    }
                })
                .catch(error => {
                    log('‚ùå Erro na exclus√£o: ' + error);
                });
            } else {
                log('üóëÔ∏è Exclus√£o cancelada pelo usu√°rio');
            }
        }

        function simularEdicao() {
            log('üé≠ Simulando edi√ß√£o completa...');
            editarCusto(1);
        }

        function simularExclusao() {
            log('üé≠ Simulando exclus√£o completa...');
            excluirCusto(1, 'combustivel', 180.50);
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            log('üöó P√°gina de teste carregada');
            log('üîß Testando funcionalidades do CRUD...');
        });
    </script>
</body>
</html>